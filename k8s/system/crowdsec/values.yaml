---
crowdsec:
  container_runtime: containerd
  agent:
    acquisition:
      - namespace: ingress-nginx
        podName: ingress-nginx-controller-*
        program: nginx
    env:
      # - name: DISABLE_ONLINE_API
      #   value: "true"
      - name: COLLECTIONS
        value: "crowdsecurity/nginx"
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
    persistentVolume:
      config:
        enabled: true
  lapi:
    env:
      # - name: DISABLE_ONLINE_API
      #   value: "true"
      # - name: ENROLL_KEY
      #   value: "<enroll-key>"
      # - name: ENROLL_INSTANCE_NAME
      #   value: "k3s-ansible"
      # - name: ENROLL_TAGS
      #   value: "k8s k3s"
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
    dashboard:
      enabled: true
      ingress:
        enabled: false
        annotations:
          nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
          cert-manager.io/cluster-issuer: letsencrypt-prod
          gethomepage.dev/enabled: "true"
          gethomepage.dev/name: Crowdsec
          gethomepage.dev/description: Dashboard for LAPI
          gethomepage.dev/group: System
          gethomepage.dev/icon: sh-crowdsec.png
          gethomepage.dev/pod-selector: "type=lapi"
        host: &crowdsec crowdsec.mdeleon.dev
        tls:
          - secretName: crowdsec-tls-cert
            hosts:
              - *crowdsec
